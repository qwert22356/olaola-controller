var n=Object.defineProperty;var c=(a,e,r)=>e in a?n(a,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):a[e]=r;var l=(a,e,r)=>c(a,typeof e!="symbol"?e+"":e,r);class u{constructor(){l(this,"apiUrl");l(this,"userId");this.apiUrl="http://127.0.0.1:8000";try{const e=localStorage.getItem("olaola_api_url");e&&(this.apiUrl=e,console.log("使用已保存的OlaOla API URL:",this.apiUrl)),this.userId=localStorage.getItem("olaola_user_id")||`user_${Date.now()}`,localStorage.getItem("olaola_user_id")||localStorage.setItem("olaola_user_id",this.userId)}catch(e){console.error("初始化OlaOla服务出错:",e),this.userId=`user_${Date.now()}`}}getVendorFromDeviceType(e){return{spine:"cisco",leaf:"huawei",tor:"ruijie",client:"h3c"}[e.toLowerCase()]||"generic"}getNetworkType(e){return["spine","leaf","tor"].includes(e.toLowerCase())?"Data Center":e.toLowerCase()==="client"?"Campus":"Enterprise"}async initializeSession(e){return console.log("为设备初始化OlaOla助手会话:",e.name),{sessionId:`session-${e.id}-${Date.now()}`}}async getReply(e,r){console.log("向OlaOla发送查询:",r,"设备:",e.name);const i={user_id:this.userId,vendor:this.getVendorFromDeviceType(e.type),network_type:"Data Center",query:r};try{console.log("发送OlaOla请求到API:",this.apiUrl,"数据:",i);const t=await fetch(`${this.apiUrl}/get_reply`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i),signal:AbortSignal.timeout(15e3)});if(console.log("OlaOla API响应状态:",t.status,t.statusText),!t.ok){let o="";try{o=await t.text()}catch{o="无法读取错误响应"}throw console.error("OlaOla API请求失败:",{status:t.status,statusText:t.statusText,errorBody:o,url:this.apiUrl}),new Error(`OlaOla API请求失败: ${t.status} ${t.statusText}. ${o}`)}return{reply:(await t.json()).reply}}catch(t){console.error("OlaOla API请求失败详情:",{error:t,message:t instanceof Error?t.message:"未知错误",url:this.apiUrl,device:e.name,type:e.type});let s="";return t instanceof Error?t.name==="AbortError"?s=`请求超时: 无法在15秒内连接到OlaOla RAG服务 (${this.apiUrl})`:t.message.includes("fetch")?s=`网络错误: 无法连接到OlaOla RAG服务器 (${this.apiUrl})。请确保服务正在运行并且可从浏览器访问。`:s=t.message:s="未知错误",{reply:`# 请求出错

无法连接到OlaOla RAG服务。

**错误详情**: ${s}

请稍后再试或联系管理员。

您可以尝试以下解决方案:
1. 确保RAG服务已启动 (使用命令: \`cd network_rag && uvicorn server:app --reload --port 8000\`)
2. 检查浏览器控制台获取更多错误信息
3. 确认网络连接正常`}}}getUserId(){return this.userId}setUserId(e){this.userId=e,localStorage.setItem("olaola_user_id",e)}getApiUrl(){return this.apiUrl}setApiUrl(e){this.apiUrl=e}}const h=new u;export{h as default};
